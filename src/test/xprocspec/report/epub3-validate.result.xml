<?xml version="1.0" encoding="UTF-8"?>
<x:test-report xmlns:x="http://www.daisy.org/ns/xprocspec">
   <x:description xmlns:cx="http://xmlcalabash.com/ns/extensions"
                  xmlns:c="http://www.w3.org/ns/xproc-step"
                  xml:base="file:/home/jostein/nordic-epub3-dtbook-migrator/src/test/xprocspec/epub3-validate.xprocspec"
                  test-base-uri="file:/home/jostein/nordic-epub3-dtbook-migrator/src/test/xprocspec/epub3-validate.xprocspec"
                  script="file:/home/jostein/nordic-epub3-dtbook-migrator/src/main/resources/xml/xproc/epub3-validate.xpl"
                  test-grammar="xprocspec"
                  temp-dir="file:/tmp/xprocspec-20141103120716441/">
      <x:step-declaration>
         <p:declare-step xmlns:p="http://www.w3.org/ns/xproc"
                         xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                         xmlns:d="http://www.daisy.org/ns/pipeline/data"
                         xmlns:epub="http://www.idpf.org/2007/ops"
                         xmlns:pxp="http://exproc.org/proposed/steps"
                         xmlns:html="http://www.w3.org/1999/xhtml"
                         xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal/nordic-epub3-dtbook-migrator"
                         type="px:nordic-epub3-validate"
                         name="main"
                         version="1.0"
                         x:type="{http://www.daisy.org/ns/pipeline/xproc}nordic-epub3-validate">
            <p:output px:media-type="application/vnd.pipeline.report+xml"
                      port="html-report"
                      kind="document"
                      sequence="false"
                      primary="false">
               <p:documentation xmlns="http://www.w3.org/1999/xhtml">
                  <h1 px:role="name">HTML Report</h1>
                  <p px:role="desc">An HTML-formatted version of the validation report.</p>
               </p:documentation>
               <p:pipe port="result" step="html"/>
            </p:output>
            <p:output px:media-type="application/vnd.pipeline.status+xml"
                      port="validation-status"
                      kind="document"
                      sequence="false"
                      primary="false">
               <p:documentation xmlns="http://www.w3.org/1999/xhtml">
                  <h1 px:role="name">Validation status</h1>
                  <p px:role="desc">Validation status (http://code.google.com/p/daisy-pipeline/wiki/ValidationStatusXML).</p>
               </p:documentation>
               <p:pipe port="result" step="status"/>
            </p:output>
            <p:option name="epub"
                      required="true"
                      px:type="anyFileURI"
                      px:media-type="application/epub+zip">
               <p:documentation xmlns="http://www.w3.org/1999/xhtml">
                  <h2 px:role="name">EPUB3 Publication</h2>
                  <p px:role="desc">EPUB3 Publication marked up according to the nordic markup guidelines.</p>
               </p:documentation>
            </p:option>
            <p:option name="temp-dir"
                      required="true"
                      px:output="temp"
                      px:type="anyDirURI">
               <p:documentation xmlns="http://www.w3.org/1999/xhtml">
                  <h2 px:role="name">Temporary directory</h2>
                  <p px:role="desc">Temporary directory for use by the script.</p>
               </p:documentation>
            </p:option>
            <p:option name="strict" select="'true'" px:type="boolean">
               <p:documentation xmlns="http://www.w3.org/1999/xhtml">
                  <h2 px:role="name">Extra strict markup</h2>
                  <p px:role="desc">Some validation rules are considered extra strict and can be disabled using this option. Examples of extra strict rules are pagebreaks being required in all documents and
                only a predefined list of languages, suppliers and publishers being allowed.</p>
               </p:documentation>
            </p:option>
         </p:declare-step>
      </x:step-declaration>
      <x:scenario xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                  xmlns:d="http://www.daisy.org/ns/pipeline/data"
                  xmlns:epub="http://www.idpf.org/2007/ops"
                  xmlns:html="http://www.w3.org/1999/xhtml"
                  xmlns:opf="http://www.idpf.org/2007/opf"
                  end-time="2014-11-03T11:07:28.345Z"
                  label="px:nordic-epub3-validate"
                  start-time="2014-11-03T11:07:21.078Z">
         <x:call x:type="{http://www.daisy.org/ns/pipeline/xproc}nordic-epub3-validate"
                 step="px:nordic-epub3-validate">
            <x:option select="resolve-uri('test-epub.epub',base-uri())"
                      name="epub"
                      value="file:/home/jostein/nordic-epub3-dtbook-migrator/src/test/xprocspec/test-epub.epub"/>
            <x:option select="$temp-dir"
                      name="temp-dir"
                      value="file:/tmp/xprocspec-20141103120716441/"/>
         </x:call>
                                                <x:context label="errors" id="errors">
                                                    
                                                </x:context>
                                            
                                                <x:expect type="count"
                   label="the step should execute successfully without throwing any errors"
                   max="0"
                   contextref="errors"/>
                                            <x:context label="validation-status" id="context0">
            <x:document xml:base="file:/home/jostein/nordic-epub3-dtbook-migrator/src/main/resources/xml/xproc/epub3-validate.xpl" xml:space="preserve" type="inline"><d:validation-status result="ok"/></x:document>
        </x:context>
         <x:expect type="compare"
                   label="test-epub.epub should be valid"
                   normalize-space="true"
                   contextref="context0">
            <x:document xml:base="file:/home/jostein/nordic-epub3-dtbook-migrator/src/test/xprocspec/epub3-validate.xprocspec" xml:space="preserve" type="inline">
                <d:validation-status result="ok"/>
            </x:document>
        </x:expect>
         <x:context label="html-report - publication statistics" id="context1">
            <x:document xml:base="file:/home/jostein/pipeline-modules/common-utils/validation-utils/src/main/resources/xml/xproc/validation-report-to-html.xpl" xml:space="preserve" type="inline"><tbody xmlns="http://www.w3.org/1999/xhtml"><tr><td>epub:type: 'backmatter'</td><td>1</td></tr><tr><td>epub:type: 'bodymatter'</td><td>5</td></tr><tr><td>epub:type: 'chapter'</td><td>4</td></tr><tr><td>epub:type: 'conclusion'</td><td>1</td></tr><tr><td>epub:type: 'cover'</td><td>1</td></tr><tr><td>epub:type: 'frontmatter'</td><td>1</td></tr><tr><td>epub:type: 'note'</td><td>103</td></tr><tr><td>epub:type: 'noteref'</td><td>103</td></tr><tr><td>epub:type: 'page-list'</td><td>1</td></tr><tr><td>epub:type: 'pagebreak'</td><td>31</td></tr><tr><td>epub:type: 'toc'</td><td>1</td></tr><tr><td>epub:type: 'z3998:initialism'</td><td>5</td></tr><tr><td>epub:type: 'z3998:production'</td><td>2</td></tr><tr><td>class: 'asciimath'</td><td>13</td></tr><tr><td>class: 'endnote'</td><td>103</td></tr><tr><td>class: 'image'</td><td>5</td></tr><tr><td>class: 'image-series'</td><td>1</td></tr><tr><td>class: 'initialism'</td><td>5</td></tr><tr><td>class: 'line'</td><td>8</td></tr><tr><td>class: 'num-with-space'</td><td>7</td></tr><tr><td>class: 'num-word'</td><td>2</td></tr><tr><td>class: 'page-front'</td><td>2</td></tr><tr><td>class: 'page-normal'</td><td>26</td></tr><tr><td>class: 'page-special'</td><td>3</td></tr><tr><td>class: 'rearcover'</td><td>1</td></tr><tr><td>class: 'render-optional'</td><td>1</td></tr><tr><td>class: 'render-required'</td><td>1</td></tr><tr><td>element: 'a'</td><td>164</td></tr><tr><td>element: 'abbr'</td><td>5</td></tr><tr><td>element: 'aside'</td><td>104</td></tr><tr><td>element: 'blockquote'</td><td>10</td></tr><tr><td>element: 'body'</td><td>9</td></tr><tr><td>element: 'div'</td><td>3</td></tr><tr><td>element: 'figcaption'</td><td>2</td></tr><tr><td>element: 'figure'</td><td>6</td></tr><tr><td>element: 'h1'</td><td>9</td></tr><tr><td>element: 'h2'</td><td>17</td></tr><tr><td>element: 'h3'</td><td>5</td></tr><tr><td>element: 'head'</td><td>9</td></tr><tr><td>element: 'html'</td><td>9</td></tr><tr><td>element: 'img'</td><td>5</td></tr><tr><td>element: 'li'</td><td>67</td></tr><tr><td>element: 'link'</td><td>22</td></tr><tr><td>element: 'meta'</td><td>27</td></tr><tr><td>element: 'nav'</td><td>2</td></tr><tr><td>element: 'ol'</td><td>6</td></tr><tr><td>element: 'p'</td><td>336</td></tr><tr><td>element: 'section'</td><td>23</td></tr><tr><td>element: 'span'</td><td>1200</td></tr><tr><td>element: 'style'</td><td>8</td></tr><tr><td>element: 'table'</td><td>1</td></tr><tr><td>element: 'tbody'</td><td>1</td></tr><tr><td>element: 'td'</td><td>69</td></tr><tr><td>element: 'title'</td><td>9</td></tr><tr><td>element: 'tr'</td><td>23</td></tr><tr><td>element: 'ul'</td><td>1</td></tr></tbody></x:document>
        </x:context>
         <x:expect label="there should be exactly one table containing statistics of elements, classes and epub:types"
                   type="count"
                   min="1"
                   max="1"
                   contextref="context1"/>
         <x:expect label="The publication statistics should contain stuff"
                   type="xpath"
                   test="count(//html:tr) &gt; 0"
                   contextref="context1"/>
      </x:scenario>
      <x:output port="html-report">
         <x:document xml:base="file:/home/jostein/pipeline-modules/common-utils/validation-utils/src/main/resources/xml/xproc/validation-report-to-html.xpl" xml:space="preserve" type="inline">
                <html xmlns="http://www.w3.org/1999/xhtml">
                    <head>
                        <title>Validation Results</title>
                        <style type="text/css"> 
                            body { 
                            font-family: helvetica; 
                            } 
                            pre.box { 
                            white-space: pre-wrap; /* css-3 */ 
                            white-space: -moz-pre-wrap; /*Mozilla, since 1999 */ 
                            white-space: -pre-wrap; /* Opera 4-6 */
                            white-space: -o-pre-wrap; /* Opera 7 */ 
                            word-wrap: break-word; /*Internet Explorer 5.5+ */ 
                            } 
                            li.error div { 
                            display: table; 
                            border: gray thin solid; 
                            padding: 5px; 
                            } 
                            li.error div h3 { 
                            display: table-cell; 
                            padding-right: 10px; 
                            font-size: smaller; 
                            } 
                            li.error div pre.box { 
                            display: table-cell; 
                            } 
                            li { 
                            padding-bottom: 15px; 
                            } 
                            #toc {
                            border-spacing: 0px;
                            }
                            #toc th, #toc td {
                            padding: 5px 30px 5px 10px;
                            border-spacing: 0px;
                            font-size: 90%;
                            margin: 0px;
                            }
                            #toc th, #toc td {
                            text-align: left;
                            border-top: 1px solid #f1f8fe;
                            border-bottom: 1px solid #cbd2d8;
                            border-right: 1px solid #cbd2d8;
                            }
                            
                            #toc tr:nth-child(odd) {
                            background-color: #e0e9f0;
                            }
                            #toc tr:nth-child(even), #toc thead th {
                            background-color: #e8eff5; !important;
                            }
                            
                        </style>
                    </head>
                    <body>
                        <div id="header">
                            <h1>Validation Results</h1>
                            <p id="datetime">Generated on 2014-11-03+01:00 at 12:07:28.322+01:00</p>
                            
                        </div>
                    <div class="document-validation-report" id="d5855e1"><div class="document-info"><p>Validated as <code>Fileset statistics</code></p><p>0 issues found.</p><table class="table table-condensed"><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>epub:type: 'backmatter'</td><td>1</td></tr><tr><td>epub:type: 'bodymatter'</td><td>5</td></tr><tr><td>epub:type: 'chapter'</td><td>4</td></tr><tr><td>epub:type: 'conclusion'</td><td>1</td></tr><tr><td>epub:type: 'cover'</td><td>1</td></tr><tr><td>epub:type: 'frontmatter'</td><td>1</td></tr><tr><td>epub:type: 'note'</td><td>103</td></tr><tr><td>epub:type: 'noteref'</td><td>103</td></tr><tr><td>epub:type: 'page-list'</td><td>1</td></tr><tr><td>epub:type: 'pagebreak'</td><td>31</td></tr><tr><td>epub:type: 'toc'</td><td>1</td></tr><tr><td>epub:type: 'z3998:initialism'</td><td>5</td></tr><tr><td>epub:type: 'z3998:production'</td><td>2</td></tr><tr><td>class: 'asciimath'</td><td>13</td></tr><tr><td>class: 'endnote'</td><td>103</td></tr><tr><td>class: 'image'</td><td>5</td></tr><tr><td>class: 'image-series'</td><td>1</td></tr><tr><td>class: 'initialism'</td><td>5</td></tr><tr><td>class: 'line'</td><td>8</td></tr><tr><td>class: 'num-with-space'</td><td>7</td></tr><tr><td>class: 'num-word'</td><td>2</td></tr><tr><td>class: 'page-front'</td><td>2</td></tr><tr><td>class: 'page-normal'</td><td>26</td></tr><tr><td>class: 'page-special'</td><td>3</td></tr><tr><td>class: 'rearcover'</td><td>1</td></tr><tr><td>class: 'render-optional'</td><td>1</td></tr><tr><td>class: 'render-required'</td><td>1</td></tr><tr><td>element: 'a'</td><td>164</td></tr><tr><td>element: 'abbr'</td><td>5</td></tr><tr><td>element: 'aside'</td><td>104</td></tr><tr><td>element: 'blockquote'</td><td>10</td></tr><tr><td>element: 'body'</td><td>9</td></tr><tr><td>element: 'div'</td><td>3</td></tr><tr><td>element: 'figcaption'</td><td>2</td></tr><tr><td>element: 'figure'</td><td>6</td></tr><tr><td>element: 'h1'</td><td>9</td></tr><tr><td>element: 'h2'</td><td>17</td></tr><tr><td>element: 'h3'</td><td>5</td></tr><tr><td>element: 'head'</td><td>9</td></tr><tr><td>element: 'html'</td><td>9</td></tr><tr><td>element: 'img'</td><td>5</td></tr><tr><td>element: 'li'</td><td>67</td></tr><tr><td>element: 'link'</td><td>22</td></tr><tr><td>element: 'meta'</td><td>27</td></tr><tr><td>element: 'nav'</td><td>2</td></tr><tr><td>element: 'ol'</td><td>6</td></tr><tr><td>element: 'p'</td><td>336</td></tr><tr><td>element: 'section'</td><td>23</td></tr><tr><td>element: 'span'</td><td>1200</td></tr><tr><td>element: 'style'</td><td>8</td></tr><tr><td>element: 'table'</td><td>1</td></tr><tr><td>element: 'tbody'</td><td>1</td></tr><tr><td>element: 'td'</td><td>69</td></tr><tr><td>element: 'title'</td><td>9</td></tr><tr><td>element: 'tr'</td><td>23</td></tr><tr><td>element: 'ul'</td><td>1</td></tr></tbody></table></div></div><div class="document-validation-report" id="d5859e1"/><div class="document-validation-report" id="d5862e2"><div class="document-info"><h2><code>file:/home/jostein/nordic-epub3-dtbook-migrator/src/test/xprocspec/test-epub.epub</code></h2><p>Validated as <code/></p><p>0 issues found.</p><table class="table table-condensed"><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>Tool Name</td><td>epubcheck-adapter</td></tr><tr><td>Tool Version</td><td>x.x</td></tr><tr><td>Tool Release Date</td><td>2014-11-03</td></tr></tbody></table></div><div class="document-report"><ul/></div></div><div class="document-validation-report" id="d5865e2"><div class="document-info"><h2><code>package.opf</code></h2><p>Validated as <code>Nordic EPUB3 Package Document</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/package.opf</code></p><p>0 issues found.</p></div><div class="document-report"><ul/></div></div><div class="document-validation-report" id="d5868e2"><div class="document-info"><h2><code>C00000-6-chapter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-6-chapter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5871e2"><div class="document-info"><h2><code>C00000-4-chapter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-4-chapter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5874e2"><div class="document-info"><h2><code>C00000-5-chapter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-5-chapter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5877e2"><div class="document-info"><h2><code>C00000-7-conclusion.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-7-conclusion.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5880e2"><div class="document-info"><h2><code>C00000-1-cover.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-1-cover.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5883e2"><div class="document-info"><h2><code>C00000-2-frontmatter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-2-frontmatter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5886e2"><div class="document-info"><h2><code>C00000-3-chapter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-3-chapter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5889e2"><div class="document-info"><h2><code>C00000-8-backmatter.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/C00000-8-backmatter.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5892e2"><div class="document-info"><h2><code>nav.xhtml</code></h2><p>Validated as <code>Nordic HTML (EPUB3 Content Document)</code></p><p>Path: <code>file:/tmp/xprocspec-20141103120716441/validate/EPUB/nav.xhtml</code></p><p>0 issues found.</p></div><div class="document-report"><ul/><ul/></div></div><div class="document-validation-report" id="d5895e2"><div class="document-info"><h2><code>All content documents (HTML) and the package document (OPF)</code></h2><p>Validated as <code>Nordic EPUB3 OPF+HTML</code></p><p>Path: <code>/</code></p><p>0 issues found.</p></div><div class="document-report"><ul/></div></div>
                <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"> </script>
            </body>
                </html>
            </x:document>
      </x:output>
      <x:output port="validation-status">
         <x:document xml:base="file:/home/jostein/nordic-epub3-dtbook-migrator/src/main/resources/xml/xproc/epub3-validate.xpl" xml:space="preserve" type="inline"><d:validation-status xmlns:d="http://www.daisy.org/ns/pipeline/data" result="ok"/></x:document>
      </x:output>
      <x:test-result xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                     xmlns:d="http://www.daisy.org/ns/pipeline/data"
                     xmlns:epub="http://www.idpf.org/2007/ops"
                     xmlns:html="http://www.w3.org/1999/xhtml"
                     xmlns:opf="http://www.idpf.org/2007/opf"
                     type="count"
                     label="the step should execute successfully without throwing any errors"
                     max="0"
                     contextref="errors"
                     result="passed">
                                                        <x:expected>At most 0 documents.</x:expected>
                                                    <x:was>0</x:was>
      </x:test-result>
      <x:test-result xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                     xmlns:d="http://www.daisy.org/ns/pipeline/data"
                     xmlns:epub="http://www.idpf.org/2007/ops"
                     xmlns:html="http://www.w3.org/1999/xhtml"
                     xmlns:opf="http://www.idpf.org/2007/opf"
                     type="compare"
                     label="test-epub.epub should be valid"
                     normalize-space="true"
                     contextref="context0"
                     result="passed"/>
      <x:test-result xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                     xmlns:d="http://www.daisy.org/ns/pipeline/data"
                     xmlns:epub="http://www.idpf.org/2007/ops"
                     xmlns:html="http://www.w3.org/1999/xhtml"
                     xmlns:opf="http://www.idpf.org/2007/opf"
                     label="there should be exactly one table containing statistics of elements, classes and epub:types"
                     type="count"
                     min="1"
                     max="1"
                     contextref="context1"
                     result="passed">
                                                        <x:expected>At least 1 and at most 1 documents.</x:expected>
                                                    <x:was>1</x:was>
      </x:test-result>
      <x:test-result xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
                     xmlns:d="http://www.daisy.org/ns/pipeline/data"
                     xmlns:epub="http://www.idpf.org/2007/ops"
                     xmlns:html="http://www.w3.org/1999/xhtml"
                     xmlns:opf="http://www.idpf.org/2007/opf"
                     label="The publication statistics should contain stuff"
                     type="xpath"
                     test="count(//html:tr) &gt; 0"
                     contextref="context1"
                     result="passed">
         <x:expected xml:space="preserve">XPath: true()
Value: true</x:expected>
         <x:was xml:space="preserve">XPath: count(//html:tr) &gt; 0
Value: true</x:was>
      </x:test-result>
   </x:description>
        </x:test-report>
