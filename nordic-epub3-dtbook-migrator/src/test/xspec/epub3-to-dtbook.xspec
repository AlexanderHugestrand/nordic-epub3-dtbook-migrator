<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec" stylesheet="../../main/resources/xml/xslt/epub3-to-dtbook.xsl" xmlns:dtbook="http://www.daisy.org/z3986/2005/dtbook/"
    xmlns:epub="http://www.idpf.org/2007/ops" xmlns:html="http://www.w3.org/1999/xhtml" xslt-version="2.0">

    <!-- dtbookblocknoimggroup -->
    <!-- no point in testing -->

    <!-- inlineinblock -->
    <!-- no point in testing -->

    <!-- block -->
    <!-- no point in testing -->

    <!-- blocknoimggroup -->
    <!-- no point in testing -->

    <!-- blocknoimggroupnotable -->
    <!-- no point in testing -->

    <!-- docblockorinline -->
    <!-- no point in testing -->

    <!-- coreattrs -->
    <x:scenario label="on a span element with the coreattrs attributes (id, class, title, xml:space, epub:type)">
        <x:context>
            <html:span id="myid" class="myclass" title="mytitle" xml:space="preserve" epub:type="z3998:sentence topic-sentence">
                <html:span id="default" epub:type="acknowledgments afterword annoref annotation appendix backmatter biblioentry bibliography bodymatter bridgehead chapter colophon concluding-sentence conclusion contributors copyright-page cover covertitle dedication division epigraph epilogue errata footnote footnotes foreword frontmatter fulltitle glossary glossdef glossterm halftitle halftitlepage help imprimatur imprint index introduction keyword landmarks list list-item loi lot marginalia note noteref notice other-credits pagebreak page-list part practice preamble preface prologue rearnote rearnotes sidebar subchapter subtitle table table-cell table-row title titlepage toc topic-sentence volume warning"/>
                <html:span id="z3998" epub:type="z3998:abbreviations z3998:acknowledgments z3998:acronym z3998:actor z3998:afterword z3998:alteration z3998:annoref z3998:annotation z3998:appendix z3998:article z3998:aside z3998:attribution z3998:author z3998:award z3998:backmatter z3998:bcc z3998:bibliography z3998:biographical-note z3998:bodymatter z3998:cardinal z3998:catalogue z3998:cc z3998:chapter z3998:citation z3998:clarification z3998:collection z3998:colophon z3998:commentary z3998:commentator z3998:compound z3998:concluding-sentence z3998:conclusion z3998:continuation z3998:continuation-of z3998:contributors z3998:coordinate z3998:correction z3998:covertitle z3998:currency z3998:decimal z3998:decorative z3998:dedication z3998:diary z3998:diary-entry z3998:discography z3998:division z3998:drama z3998:dramatis-personae z3998:editor z3998:editorial-note z3998:email z3998:email-message z3998:epigraph z3998:epilogue z3998:errata z3998:essay z3998:event z3998:example z3998:family-name z3998:fiction z3998:figure z3998:filmography z3998:footnote z3998:footnotes z3998:foreword z3998:fraction z3998:from z3998:frontispiece z3998:frontmatter z3998:ftp z3998:fulltitle z3998:gallery z3998:general-editor z3998:geographic z3998:given-name z3998:glossary z3998:grant-acknowledgment z3998:grapheme z3998:halftitle z3998:halftitle-page z3998:help z3998:homograph z3998:http z3998:hymn z3998:illustration z3998:image-placeholder z3998:imprimatur z3998:imprint z3998:index z3998:initialism z3998:introduction z3998:introductory-note z3998:ip z3998:isbn z3998:keyword z3998:letter z3998:loi z3998:lot z3998:lyrics z3998:marginalia z3998:measure z3998:mixed z3998:morpheme z3998:name-title z3998:nationality z3998:non-fiction z3998:nonresolving-citation z3998:nonresolving-reference z3998:note z3998:noteref z3998:notice z3998:orderedlist z3998:ordinal z3998:organization z3998:other-credits z3998:pagebreak z3998:page-footer z3998:page-header z3998:part z3998:percentage z3998:persona z3998:personal-name z3998:pgroup z3998:phone z3998:phoneme z3998:photograph z3998:phrase z3998:place z3998:plate z3998:poem z3998:portmanteau z3998:postal z3998:postal-code z3998:postscript z3998:practice z3998:preamble z3998:preface z3998:prefix z3998:presentation z3998:primary z3998:product z3998:production z3998:prologue z3998:promotional-copy z3998:published-works z3998:publisher-address z3998:publisher-logo z3998:range z3998:ratio z3998:rearnote z3998:rearnotes z3998:recipient z3998:recto z3998:reference z3998:republisher z3998:resolving-reference z3998:result z3998:role-description z3998:roman z3998:root z3998:salutation z3998:scene z3998:secondary z3998:section z3998:sender z3998:sentence z3998:sidebar z3998:signature z3998:song z3998:speech z3998:stage-direction z3998:stem z3998:structure z3998:subchapter z3998:subject z3998:subsection z3998:subtitle z3998:suffix z3998:surname z3998:taxonomy z3998:tertiary z3998:text z3998:textbook z3998:t-form z3998:timeline z3998:title z3998:title-page z3998:to z3998:toc z3998:topic-sentence z3998:translator z3998:translator-note z3998:truncation z3998:unorderedlist z3998:valediction z3998:verse z3998:verso z3998:v-form z3998:volume z3998:warning z3998:weight z3998:word"/>
            </html:span>
        </x:context>
        <x:expect label="all the attributes should be preserved, except for the epub:type attribute which should be made into a class">
            <dtbook:span id="myid" class="myclass sentence topic-sentence" title="mytitle" xml:space="preserve">
                <dtbook:span id="default" class="acknowledgments afterword annoref annotation appendix backmatter biblioentry bibliography bodymatter bridgehead chapter colophon concluding-sentence conclusion contributors copyright-page cover covertitle dedication division epigraph epilogue errata footnote footnotes foreword frontmatter fulltitle glossary glossdef glossterm halftitle halftitlepage help imprimatur imprint index introduction keyword landmarks list list-item loi lot marginalia note noteref notice other-credits pagebreak page-list part practice preamble preface prologue rearnote rearnotes sidebar subchapter subtitle table table-cell table-row title titlepage toc topic-sentence volume warning"/>
                <dtbook:span id="z3998" class="abbreviations acknowledgments acronym actor afterword alteration annoref annotation appendix article aside attribution author award backmatter bcc bibliography biographical-note bodymatter cardinal catalogue cc chapter citation clarification collection colophon commentary commentator compound concluding-sentence conclusion continuation continuation-of contributors coordinate correction covertitle currency decimal decorative dedication diary diary-entry discography division drama dramatis-personae editor editorial-note email email-message epigraph epilogue errata essay event example family-name fiction figure filmography footnote footnotes foreword fraction from frontispiece frontmatter ftp fulltitle gallery general-editor geographic given-name glossary grant-acknowledgment grapheme halftitle halftitle-page help homograph http hymn illustration image-placeholder imprimatur imprint index initialism introduction introductory-note ip isbn keyword letter loi lot lyrics marginalia measure mixed morpheme name-title nationality non-fiction nonresolving-citation nonresolving-reference note noteref notice orderedlist ordinal organization other-credits pagebreak page-footer page-header part percentage persona personal-name pgroup phone phoneme photograph phrase place plate poem portmanteau postal postal-code postscript practice preamble preface prefix presentation primary product production prologue promotional-copy published-works publisher-address publisher-logo range ratio rearnote rearnotes recipient recto reference republisher resolving-reference result role-description roman root salutation scene secondary section sender sentence sidebar signature song speech stage-direction stem structure subchapter subject subsection subtitle suffix surname taxonomy tertiary text textbook t-form timeline title title-page to toc topic-sentence translator translator-note truncation unorderedlist valediction verse verso v-form volume warning weight word"/>
            </dtbook:span>
        </x:expect>
    </x:scenario>

    <!-- i18n -->
    <x:scenario label="on a html element with the i18n attributes (xml:lang, dir)">
        <x:context>
            <html:html xml:lang="en" dir="ltr">...</html:html>
        </x:context>
        <x:expect label="the xml:lang attribute should be preserved" test="/*/@xml:lang='en'"/>
        <x:expect label="the dir attribute should be preserved" test="/*/@dir='ltr'"/>
    </x:scenario>

    <!-- attrs -->

    <!-- attrsrqd -->

    <!-- dtbookcontent -->
    <x:scenario label="dtbookcontent (head, body)">
        <x:context>
            <html:html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#">
                <html:head>...</html:head>
                <html:body>...</html:body>
            </html:html>
        </x:context>
        <x:expect label="should be allowed inside the html element">
            <dtbook:dtbook version="2005-3">
                <dtbook:head>...</dtbook:head>
                <dtbook:book>...</dtbook:book>
            </dtbook:dtbook>
        </x:expect>
    </x:scenario>

    <!-- dtbook -->
    <x:scenario label="when processing a html element">
        <x:context>
            <html:html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#">...</html:html>
        </x:context>
        <x:expect label="the html element should be converted into a dtbook element and a version attribute should be added">
            <dtbook:dtbook version="2005-3">...</dtbook:dtbook>
        </x:expect>
    </x:scenario>
    <!-- dtbook -->

    <!-- attlist.dtbook -->
    <x:scenario label="on a html element with the epub:prefix attribute">
        <x:context>
            <html:html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#">...</html:html>
        </x:context>
        <x:expect label="the epub:prefix attribute should be removed" test="not(/*/@epub:prefix)"/>
    </x:scenario>

    <!-- headmisc -->
    <!-- no point in testing headmisc -->

    <!-- head -->
    <x:scenario label="when processing a head element">
        <x:context>
            <html:head>...</html:head>
        </x:context>
        <x:expect label="the head element should be converted into a head element">
            <dtbook:head>...</dtbook:head>
        </x:expect>
    </x:scenario>

    <!-- attlist.head -->

    <!-- link -->

    <!-- attlist.link -->

    <!-- meta -->
    <x:scenario label="when processing a meta element">
        <x:context>
            <html:meta/>
        </x:context>
        <x:expect label="the meta element should be converted into a meta element">
            <dtbook:meta/>
        </x:expect>
        <!-- TODO: add test in head element: if there is no html:meta/dc:title, use the title element for dtbook:meta/dc:title -->
    </x:scenario>

    <!-- attlist.meta -->
    <x:scenario label="when processing the meta element attributes">
        <x:context>
            <html:meta http-equiv="http-equiv" name="name" content="content" charset="charset"/>
        </x:context>
        <x:expect label="the http-equiv, name and content attributes should be copied but the charset attribute should be dropped">
            <dtbook:meta http-equiv="http-equiv" name="name" content="content"/>
        </x:expect>
    </x:scenario>

    <!-- book -->
    <x:scenario label="when processing a body element">
        <x:context>
            <html:body>...</html:body>
        </x:context>
        <x:expect label="the body element should be converted into a book element">
            <dtbook:book>...</dtbook:book>
        </x:expect>
    </x:scenario>

    <!-- cover -->
    <x:scenario label="when processing a cover in a body">
        <x:context>
            <html:body>
                <html:section epub:type="cover" class="classA classB"/>
            </html:body>
        </x:context>
        <x:expect label="the resulting element should be a level1 inside the frontmatter">
            <dtbook:book>
                <dtbook:frontmatter>
                    <dtbook:level1 class="classA classB cover"/>
                </dtbook:frontmatter>
            </dtbook:book>
        </x:expect>
    </x:scenario>

    <!-- frontmatter -->
    <!-- frontmatter.titlepage -->
    <!-- frontmatter.colophon -->
    <!-- frontmatter.toc -->
    <!-- frontmatter.foreword -->
    <!-- frontmatter.introduction -->
    <!-- frontmatter.other -->
    <!-- frontmatter.generic -->

    <!-- bodymatter -->
    <!-- bodymatter.prologue -->
    <!-- bodymatter.preface -->
    <!-- bodymatter.part -->
    <!-- bodymatter.chapter -->
    <!-- bodymatter.conclusion -->
    <!-- bodymatter.epilogue -->
    <!-- bodymatter.generic -->

    <!-- rearmatter -->
    <!-- rearmatter.afterword -->
    <!-- rearmatter.toc -->
    <!-- rearmatter.index -->
    <!-- rearmatter.appendix -->
    <!-- rearmatter.glossary -->
    <!-- rearmatter.footnotes -->
    <!-- rearmatter.rearnotes -->
    <!-- rearmatter.other -->
    <!-- rearmatter.generic -->

    <!-- level -->
    <!-- level.content -->

    <!-- attlist.level -->

    <!-- level1 -->
    <!-- level1.content -->
    <!-- attlist.level1 -->

    <!-- level2 -->
    <!-- level2.content -->
    <!-- attlist.level2 -->

    <!-- level3 -->
    <!-- level3.content -->
    <!-- attlist.level3 -->

    <!-- level4 -->
    <!-- level4.content -->
    <!-- attlist.level4 -->

    <!-- level5 -->
    <!-- level5.content -->
    <!-- attlist.level5 -->

    <!-- level6 -->
    <!-- level6.content -->
    <!-- attlist.level6 -->

    <!-- phrase -->
    <!-- phrasenodfn -->

    <!-- special -->

    <!-- specialnoa -->

    <!-- dtbookinline -->
    <!-- dtbookinlinenoa -->

    <!-- inline -->

    <!-- inlinenoa -->
    <!-- inlinenodfn -->

    <!-- inlines -->

    <!-- inlinew -->

    <!-- inlinenopagenum -->

    <!-- inlinenoprodnote -->

    <!-- flow -->

    <!-- flownopagenum -->
    <!-- flownotable -->

    <!-- br -->

    <!-- attlist.br -->

    <!-- line -->
    <!-- attlist.line -->

    <!-- linenum -->

    <!-- address -->
    <!-- attlist.address -->

    <!-- div -->

    <!-- attlist.div -->

    <!-- inlinetitle -->
    <!-- title -->
    <!-- title.content -->
    <!-- attlist.title -->

    <!-- author -->
    <!-- attlist.author -->

    <!-- prodnote -->

    <!-- attlist.prodnote -->

    <!-- sidebar -->

    <!-- attlist.sidebar -->

    <!-- note -->
    <!-- attlist.note -->

    <!-- annotation -->
    <!-- attlist.annotation -->

    <!-- epigraph -->
    <!-- attlist.epigraph -->

    <!-- byline -->
    <!-- attlist.byline -->

    <!-- dateline -->
    <!-- attlist.dateline -->

    <!-- linegroup -->

    <!-- attlist.linegroup -->

    <!-- poem -->
    <!-- attlist.poem -->

    <!-- a -->

    <!-- attlist.a -->

    <!-- em -->
    <!-- attlist.em -->

    <!-- strong -->
    <!-- attlist.strong -->

    <!-- dfn -->
    <!-- attlist.dfn -->

    <!-- kbd -->
    <!-- attlist.kbd -->

    <!-- code -->

    <!-- attlist.code -->

    <!-- samp -->

    <!-- attlist.samp -->

    <!-- cite -->
    <!-- attlist.cite -->

    <!-- abbr -->

    <!-- attlist.abbr -->

    <!-- acronym -->

    <!-- attlist.acronym -->

    <!-- sub -->
    <!-- attlist.sub -->

    <!-- sup -->
    <!-- attlist.sup -->

    <!-- span -->
    <!-- attlist.span -->

    <!-- bdo -->

    <!-- attlist.bdo -->

    <!-- sent -->
    <!-- attlist.sent -->

    <!-- w -->
    <!-- attlist.w -->

    <!-- pagenum -->

    <!-- attlist.pagenum -->

    <!-- noteref -->

    <!-- attlist.noteref -->

    <!-- annoref -->

    <!-- attlist.annoref -->

    <!-- q -->

    <!-- attlist.q -->

    <!-- Length -->

    <!-- MultiLength -->

    <!-- Pixels -->

    <!-- img -->

    <!-- attlist.img -->

    <!-- imggroup -->
    <!-- attlist.imggroup -->

    <!-- p -->
    <!-- attlist.p -->

    <!-- doctitle -->
    <!-- attlist.doctitle -->

    <!-- docauthor -->
    <!-- attlist.docauthor -->

    <!-- covertitle -->
    <!-- attlist.covertitle -->

    <!-- h1 -->
    <!-- attlist.h1 -->

    <!-- h2 -->
    <!-- attlist.h2 -->

    <!-- h3 -->
    <!-- attlist.h3 -->

    <!-- h4 -->
    <!-- attlist.h4 -->

    <!-- h5 -->
    <!-- attlist.h5 -->

    <!-- h6 -->
    <!-- attlist.h6 -->

    <!-- bridgehead -->
    <!-- attlist.bridgehead -->

    <!-- hd -->
    <!-- attlist.hd -->

    <!-- blockquote -->

    <!-- attlist.blockquote -->

    <!-- dl -->
    <!-- attlist.dl -->

    <!-- dt -->
    <!-- attlist.dt -->

    <!-- dd -->
    <!-- attlist.dd -->

    <!-- list -->

    <!-- attlist.list.ordered -->

    <!-- attlist.list.preformatted -->

    <!-- attlist.list.unordered -->

    <!-- li -->
    <!-- attlist.li -->

    <!-- lic -->

    <!-- attlist.lic -->

    <!-- Scope -->

    <!-- TFrame -->

    <!-- TRules -->

    <!-- cellhvalign -->

    <!-- table -->

    <!-- attlist.table -->

    <!-- caption.table -->
    <!-- caption.figure -->

    <!-- attlist.caption -->

    <!-- thead -->
    <!-- attlist.thead -->

    <!-- tfoot -->
    <!-- attlist.tfoot -->

    <!-- tbody -->
    <!-- attlist.tbody -->

    <!-- colgroup -->

    <!-- attlist.colgroup -->

    <!-- col -->

    <!-- attlist.col -->

    <!-- tr -->

    <!-- attlist.tr -->

    <!-- th -->

    <!-- attlist.th -->

    <!-- td -->

    <!-- attlist.td -->


    <!-- ########## Regression tests ########## -->

    <x:scenario label="if first section element doesn't include an epub:type">
        <x:context>
            <html:body>
                <html:section/>
            </html:body>
        </x:context>
        <x:expect label="then the section should map to a 'bodymatter'-level1">
            <dtbook:book>
                <dtbook:bodymatter>
                    <dtbook:level1/>
                </dtbook:bodymatter>
            </dtbook:book>
        </x:expect>
    </x:scenario>


    <!-- ########## Nordic tests ########## -->

    <!--
        precedingemptyline class
        discussion: https://github.com/josteinaj/nordic-epub3-dtbook-migrator/issues/2
    -->
    <x:scenario label="when processing a paragraph">
        <x:scenario label="with a preceding hr and a precedingemptyline class">
            <x:context>
                <html:section epub:type="bodymatter">
                    <html:p>Some text</html:p>
                    <!-- thematic break occurs here -->
                    <html:hr/>
                    <html:p class="precedingemptyline">More text</html:p>
                </html:section>
            </x:context>
            <x:expect label="the html version should add a preceding hr element">
                <dtbook:level1 class="bodymatter">
                    <dtbook:p>Some text</dtbook:p>
                    <!-- thematic break occurs here -->
                    <dtbook:p class="precedingemptyline">More text</dtbook:p>
                </dtbook:level1>
            </x:expect>
        </x:scenario>

        <x:scenario label="with a preceding hr but without a precedingemptyline class">
            <x:context>
                <html:section epub:type="bodymatter">
                    <html:p>Some text</html:p>
                    <!-- thematic break occurs here -->
                    <html:hr/>
                    <html:p>More text</html:p>
                </html:section>
            </x:context>
            <x:expect label="the html version should add a preceding hr element">
                <dtbook:level1 class="bodymatter">
                    <dtbook:p>Some text</dtbook:p>
                    <!-- thematic break occurs here -->
                    <dtbook:p class="precedingemptyline">More text</dtbook:p>
                </dtbook:level1>
            </x:expect>
        </x:scenario>
    </x:scenario>
    
    <!-- #### From MTMs DTBook schema #### -->
    <!-- TODO: convert MTM-schema to XSpec tests here -->

</x:description>
